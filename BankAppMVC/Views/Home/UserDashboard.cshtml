@{
    var user = ViewBag.CurrentUser as BankAppMVC.Models.UserModel;
    var accounts = ViewBag.Accounts as List<BankAppMVC.Models.AccountModel>;
    var transactions = ViewBag.Transactions as List<BankAppMVC.Models.TransactionModel>;
}

<div class="container mt-4">
    <h2 class="mb-4">Welcome, @user.Name 👋</h2>

    <!-- User Profile Card -->
    <div class="card mb-4">
        <div class="card-body d-flex align-items-center">
            <img src="@user.Picture" alt="Profile Picture" class="rounded-circle me-3" style="width:80px; height:80px; object-fit:cover;" />
            <div>
                <h4>@user.Name</h4>
                <p class="mb-1"><b>Email:</b> @user.Email</p>
                <p class="mb-1"><b>Phone:</b> @user.Phone</p>
                <p class="mb-1"><b>Address:</b> @user.Address</p>
                <a asp-action="EditProfile" class="btn btn-sm btn-warning">✏ Edit Profile</a>
                <a asp-action="Logout" asp-controller="Accounts" class="btn btn-sm btn-danger">🚪 Logout</a>
            </div>
        </div>
    </div>

    
    <!-- Accounts Section -->
    <h4>Your Accounts</h4>
    <div class="row mb-4">
        @if (accounts != null && accounts.Any())
        {
            foreach (var account in accounts)
            {
                <div class="col-md-4">
                    <div class="card shadow-sm mb-3">
                        <div class="card-body">
                            <h5 class="card-title">Account #@account.AccountNumber</h5>
                            <p><b>Type:</b> @account.AccountType</p>
                            <p><b>Balance:</b> $@account.Balance.ToString("N2")</p>
                            <!-- Button to go to Transfer page for this account -->
                            <a class="btn btn-primary mt-2"
                               asp-controller="Transactions"
                               asp-action="Transfer"
                               asp-route-accountNumber="@account.AccountNumber">
                                Transfer Money
                            </a>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <p>No accounts found.</p>
        }
    </div>

    <form method="get" asp-action="UserDashboard">
        <label for="startDate">Start Date:</label>
        <input type="date" id="startDate" name="startDate" value="@ViewBag.StartDate">

        <label for="endDate">End Date:</label>
        <input type="date" id="endDate" name="endDate" value="@ViewBag.EndDate">

        <button type="submit">Filter</button>
    </form>


    <!-- Transactions Section -->
    <h4>Recent Transactions</h4>
    @if (transactions != null && transactions.Any())
    {
        <table class="table table-striped table-bordered mt-2">
            <thead class="table-dark">
                <tr>
                    <th>Date</th>
                    <th>Description</th>
                    <th>Amount</th>
                    <th>Type</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var txn in transactions.OrderByDescending(t => t.Date).Take(10)) // show latest 10
                {
                    <tr>
                        <td>@txn.Date.ToString("yyyy-MM-dd")</td>
                        <td>@txn.Description</td>
                        <td>@txn.Amount.ToString("C")</td>
                        <td>
                            @if (txn.Type == "Credit")
                            {
                                <span class="badge bg-success">Credit</span>
                            }
                            else
                            {
                                <span class="badge bg-danger">Debit</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p>No transactions found.</p>
    }
</div>
